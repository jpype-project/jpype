os:
  - linux

language: python

python:
  - '2.6'
  - '2.7'
  - '3.3'
  - '3.4'
  - '3.5'
  - '3.6'
  - 'pypy'
  - 'pypy3'
  - 'nightly'

addons:
  apt:
    packages:
    - ant
    - openjdk-6-jdk
    - openjdk-7-jdk
    - openjdk-8-jdk
    - openjdk-9-jdk

env:
  # one build with and without numpy support (opt numpy out)
  # major java releases
  - JAVA_VERSION=6  NUMPY="--install-option=--disable-numpy"
  - JAVA_VERSION=7  NUMPY="--install-option=--disable-numpy"
  - JAVA_VERSION=8  NUMPY="--install-option=--disable-numpy"
  - JAVA_VERSION=9  NUMPY="--install-option=--disable-numpy"
  - JAVA_VERSION=6  NUMPY=""
  - JAVA_VERSION=7  NUMPY=""
  - JAVA_VERSION=8  NUMPY=""
  - JAVA_VERSION=9  NUMPY=""


matrix:
  allow_failures:
    - python: 'pypy'
      env: NUMPY="--install-option=--disable-numpy"
    - python: 'pypy3'
      env: NUMPY="--install-option=--disable-numpy"
    - python: 'pypy'
      env: NUMPY=""
    - python: 'pypy3'
      env: NUMPY=""
    - python: 'nightly'
      env: NUMPY=""
    - python: 'nightly'
      env: NUMPY="--install-option=--disable-numpy"

# TODO: exclude some matrix elements, as this matrix is likeli too large.
# set JAVA_HOME
before_install:
  - |
    if [[ ${JAVA_VERSION} -lt 9 ]];
       then export JAVA_HOME="/usr/lib/jvm/java-${JAVA_VERSION}-openjdk-amd64"
    else
       export JAVA_HOME='/usr/lib/jvm/java-9-oracle'
    fi
install:
  - ls -alh /usr/lib/jvm/
  - pip install . $NUMPY
  - pip install -r test-requirements.txt
  - ant -f test/build.xml -v

script:
  - python -c "import jpype"
  - python test/testsuite.py
